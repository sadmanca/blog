<html lang="en">
 <head>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/simplebar@latest/dist/simplebar.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/simplebar@latest/dist/simplebar.min.js"></script>
   <script src="https://cdn.jsdelivr.net/npm/ag-grid-enterprise/dist/ag-grid-enterprise.min.js"></script>
   <style>
    .cell-wrap-text {
      white-space: normal !important;
    }

    .ag-theme-quartz .ag-cell-value {
      line-height: 15px !important;
      word-break: break-word;
      padding-top: 5px;
      padding-bottom: 5px;
    }

    .cell-ellipsis {
      display: -webkit-box;
      -webkit-box-orient: vertical;
      -webkit-line-clamp: 3;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: normal;
    }

    .scrollable-cell {
      /* max-height: 100px; */
      overflow-y: auto; Enables vertical scrolling
    }

    .simplebar-scrollbar::before {
      background-color: rgba(0, 0, 0, 0.1); /* Red with 50% opacity */
    }

    .scrollable-cell:hover .simplebar-scrollbar::before {
      background-color: rgba(0, 0, 0, 0.75); /* Red with 50% opacity */
    }
  </style>
  <noscript>
    <style>
      /**
      * Reinstate scrolling for non-JS clients
      */
      .simplebar-content-wrapper {
        scrollbar-width: auto;
        -ms-overflow-style: auto;
      }

      .simplebar-content-wrapper::-webkit-scrollbar,
      .simplebar-hide-scrollbar::-webkit-scrollbar {
        display: initial;
        width: initial;
        height: initial;
      }
    </style>
  </noscript>
 </head>
  <body>
    <div id="myGrid" style="width: 100%; height: 100%" class="ag-theme-quartz"></div>
  </body>
</html>

<script>
  function scrollableCellRenderer(params) {
    // Check if params.value exists and replace newline characters with HTML line breaks
    const formattedValue = params.value ? params.value.replace(/\n/g, '<br><br>') : '';
    return `<div class="scrollable-cell" data-simplebar data-simplebar-auto-hide="false">${formattedValue}</div>`;
  }

  function CompanyWebsiteRenderer(params) {
    // Ensure params.value is defined and is a string
    if (typeof params.value !== 'string') return '';

    // Extract the first URL from the text
    const urlMatch = params.value.match(/https?:\/\/[^ \n]+/);
    if (!urlMatch) return params.value; // Return original text if no URL found

    const firstUrl = urlMatch[0];
    const link = `<a href="${firstUrl}" target="_blank">${new URL(firstUrl).hostname}</a>`;
    return link;
  }

  function MultiLineTextCellEditor() {}

  MultiLineTextCellEditor.prototype.init = function(params) {
    this.params = params;
    this.eGui = document.createElement('textarea');
    this.eGui.style.width = '100%';
    this.eGui.style.height = '100%';
    this.eGui.value = params.value;
  };

  MultiLineTextCellEditor.prototype.getGui = function() {
    return this.eGui;
  };

  MultiLineTextCellEditor.prototype.afterGuiAttached = function() {
    this.eGui.focus();
    this.eGui.select();
  };

  MultiLineTextCellEditor.prototype.getValue = function() {
    return this.eGui.value;
  };

  MultiLineTextCellEditor.prototype.destroy = function() {};

  const gridOptions = {
    columnDefs: [
      // {
      //   headerName: "Row",
      //   maxWidth: 100,
      //   // it is important to have node.id here, so that when the id changes (which happens
      //   // when the row is loaded) then the cell is refreshed.
      //   valueGetter: "node.id",
      //   cellRenderer: (params) => {
      //     if (params.value !== undefined) {
      //       return params.value;
      //     } else {
      //       return '<img src="https://www.ag-grid.com/example-assets/loading.gif">';
      //     }
      //   },
      // },
      {
        field: "postingDate",
        width: 125,
        rowGroup: true,
        hide: false,
      },
      {
        field: "title",
        width: 125,
      },
      {
        field: "company",
        rowGroup: true,
        width: 135,
      },
      {
        field: "companyWebsite",
        cellRenderer: CompanyWebsiteRenderer,
        width: 135,
      },
      {
        field: "location",
        width: 130,
      },
      {
        field: "locationType",
        width: 130,
      },
      {
        field: "numPositions",
        headerName: "Num of Positions",
        width: 130,
        // Use a value formatter to check the value before displaying
        valueFormatter: function(params) {
          // Check if the value is a valid number
          const isValidNumber = !isNaN(params.value) && isFinite(params.value);
          // Return the value if it's a valid number, otherwise return an empty string
          return isValidNumber ? params.value : '';
        },
      },
      {
        field: "description",
        width: 350,
        wrapText: true,
        // cellClass: 'cell-wrap-text',
        // autoHeight: true,
        cellRenderer: scrollableCellRenderer,
      },
      {
        field: "requirements",
        width: 350,
        wrapText: true,
        // cellClass: 'cell-wrap-text',
        // autoHeight: true,
        cellRenderer: scrollableCellRenderer,
      },
      {
        field: "salary",
        width: 115,

      },
      {
        field: "preferredDisciplines",
        width: 150,
        // wrapText: false,
        cellRenderer: scrollableCellRenderer,
      },
      {
        field: "startDate",
        width: 110,
      },
      {
        field: "endDate",
        width: 110,
      },
      {
        field: "companyDivision",
        width: 135,
      },
      {
        field: "function",
        width: 130,
      },
      {
        field: "applicationDeadline",
        width: 150,
      },
      // {
      //   field: "applicationMethod",

      // },
      {
        field: "applicationReceiptProcedure",
        headerName: "Application Procedure",
        width: 150,
        cellRenderer: scrollableCellRenderer,
      },
      {
        field: "applicationDetails",
        width: 150,
        cellRenderer: scrollableCellRenderer,
      },
      {
        field: "id",
        headerName: "Job ID",
        maxWidth: 130,
      },
    ],
    // rowHeight: 250,
    getRowHeight: function(params) {
      // Check if the row is a group row
      if (params.node.group) {
        // Return the desired height for group rows
        return 30; // Example: Set group row height to 100px
      }
      // Return a different height for non-group rows or default height
      return 250; // Example: Set non-group row height to 25px
    },
    groupDefaultExpanded: -1,
    groupDisplayType: 'groupRows',

    tooltipShowDelay: 5000,
    defaultColDef: {
      resizable: true,
      sortable: true,
      initialWidth: 170,
      editable: true,
      filter: true,
      wrapText: true,
      cellEditor: MultiLineTextCellEditor,
      wrapHeaderText: true,
      autoHeaderHeight: true,
    },
    // onGridReady: function(params) {
    //   fetch("/pages/JobPosting.json")
    //     .then(response => response.json())
    //     .then(data => {
    //       params.api.applyTransaction({ add: data });
    //       params.api.hideOverlay();
    //     })
    //     .catch(error => {
    //       console.error("Failed to load data", error);
    //       params.api.showNoRowsOverlay();
    //     });
    // },

    pagination: true,
    // paginationAutoPageSize: true,
    // paginateChildRows: true,
    paginationPageSize: 1,
    // paginationPageSizeSelector: [10, 20, 30, 40, 50, 60, 70, 80, 90, 100],

    // rowBuffer: 0,
    // rowSelection: "multiple",
    // // tell grid we want virtual row model type
    // rowModelType: "infinite",
    // // how big each page in our page cache will be, default is 100
    // cacheBlockSize: 50,
    // // how many extra blank rows to display to the user at the end of the dataset,
    // // which sets the vertical scroll and then allows the grid to request viewing more rows of data.
    // // default is 1, ie show 1 row.
    // cacheOverflowSize: 2,
    // // how many server side requests to send at a time. if user is scrolling lots, then the requests
    // // are throttled down
    // maxConcurrentDatasourceRequests: 1,
    // // how many rows to initially show in the grid. having 1 shows a blank row, so it looks like
    // // the grid is loading from the users perspective (as we have a spinner in the first col)
    // infiniteInitialRowCount: 50,
    // // how many pages to store in cache. default is undefined, which allows an infinite sized cache,
    // // pages are never purged. this should be set for large data to stop your browser from getting
    // // full of data
    // maxBlocksInCache: 10,
  };

  // // setup the grid after the page has finished loading
  // document.addEventListener("DOMContentLoaded", function () {
  //   const gridDiv = document.querySelector("#myGrid");
  //   gridApi = agGrid.createGrid(gridDiv, gridOptions);

  //   fetch("/pages/JobPosting.json")
  //     .then((response) => response.json())
  //     .then(function (data) {
  //       const dataSource = {
  //         rowCount: undefined, // behave as infinite scroll

  //         getRows: (params) => {
  //           // take a slice of the total rows
  //           const rowsThisPage = data.slice(params.startRow, params.endRow);
  //           // if on or after the last page, work out the last row.
  //           let lastRow = -1;
  //           if (data.length <= params.endRow) {
  //             lastRow = data.length;
  //           }
  //           // call the success callback
  //           params.successCallback(rowsThisPage, lastRow);
  //         },
  //       };

  //       gridApi.setGridOption("datasource", dataSource);
  //     });
  // });

  document.addEventListener("DOMContentLoaded", function () {
    var gridDiv = document.querySelector("#myGrid");
    gridApi = agGrid.createGrid(gridDiv, gridOptions);

    fetch("/pages/JobPosting.json")
      .then((response) => response.json())
      .then((data) => gridApi.setGridOption("rowData", data));
  });
</script>